generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model users {
  id                                                                                     String?                           @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  public_id                                                                               String                            @unique
  first_name                                                                             String                            @db.VarChar(50)
  last_name                                                                              String                            @db.VarChar(50)
  email                                                                                  String                            @db.VarChar(255)
  password                                                                               String?                           @db.VarChar(255)
  role                                                                                   user_role?                        @default(creator)
  created_at                                                                             DateTime?                         @default(now()) @db.Timestamp(6)
  
  ref_users_stats                                                                        users_stats?
  users_description                                                                      users_description?
  users_product                                                                          users_product[]
  ref_table_interaction_followers_target                                                 users_interactions_followers[]                 @relation("users_target")
  ref_table_interaction_followers_sender                                                 users_interactions_followers[]                 @relation("users_sender")
  ref_table_interaction_vote_sender                                                      users_interactions_vote[]           @relation("video_vote_sender")
  ref_table_interaction_comment                                                          users_interactions_comment[]
  ref_table_interaction_bookmark                                                         users_interactions_bookmark[]
  ref_table_interaction_report_sender                                                           users_interactions_report[]          @relation("report_sender")
  ref_table_interaction_report_receiver                                                           users_interactions_report[]          @relation("report_receiver")

  @@index([role])
  @@index([created_at])
}

model users_description {
  ref_id         String       @unique @db.Uuid
  username       String       @db.VarChar(50)
  biodata        String?      
  gender         user_gender? @default(anonymous)
  phone_number   String?         
  location       String?      
  picture        String?      
  social_link    Json?        @default("[]")
  updated_at     DateTime?    
  users          users        @relation(fields: [ref_id], references: [id], onDelete: Cascade)
}

model users_stats {
  ref_id_user     String   @db.Uuid @unique
  total_views     Int      @default(0)
  total_likes     Int      @default(0)
  total_followers Int      @default(0)
  total_image  Int      @default(0)
  total_video  Int      @default(0)
  total_music  Int      @default(0)
  total_report  Int      @default(0)

  this_ref_user   users   @relation(fields: [ref_id_user], references: [id], onDelete: Cascade)

  @@index([ref_id_user])
}


model users_product {
  ref_id                       String                         @db.Uuid
  id_product                   Int                            @unique
  type                         type_product?
  folder_name                  String                         @db.VarChar(255)
  status                       Boolean?                       @default(true)
  created_at                   DateTime?                      @default(now()) @db.Timestamp(6)
  users                        users                          @relation(fields: [ref_id], references: [id], onDelete: Cascade)
  users_product_image          users_product_image?
  users_product_video          users_product_video?

  ref_table_photo_stats        users_photo_stats?
  ref_table_video_stats        users_video_stats?
  ref_table_users_interaction_vote    users_interactions_vote[]
  ref_table_users_interaction_comment   users_interactions_comment[]
  ref_table_users_interaction_bookmark   users_interactions_bookmark[]
  ref_table_users_interaction_report   users_interactions_report[]

  @@index([ref_id], name: "idx_ref_id")
  @@index([created_at], name: "idx_created_at")
  @@index([type], name: "idx_type")
  @@index([folder_name], name: "idx_folder_name")
  @@index([ref_id, created_at], name: "idx_ref_id_created_at")
}

model users_product_image {
  ref_id_product Int           @unique
  description    String        @db.VarChar(255)
  image_name     String        @db.VarChar(255)
  url            String        @db.VarChar(255)
  hashtag        String[]      @default([])
  category       String[]      @default([])
  users_product  users_product @relation(fields: [ref_id_product], references: [id_product], onDelete: Cascade)
}

model users_product_video {
  ref_id_product  Int             @unique
  description     String          @db.VarChar(255)
  duration        Float?
  width           Int?
  height          Int?
  format          String?
  cloud_public_id      String          @db.VarChar(255)
  url             String          @db.VarChar(255)
  thumbnail_url   String          @db.VarChar(255)           
  hashtag         String[]        @default([])
  category        String[]        @default([])

  users_product   users_product   @relation(fields: [ref_id_product], references: [id_product], onDelete: Cascade)

  @@unique([ref_id_product, cloud_public_id])
}

model users_photo_stats {
  ref_id_product      Int       @unique
  views               Int?      @default(0)
  like                Int?      @default(0)
  dislike             Int?      @default(0)
  share               Int?      @default(0)
  bookmark            Int?      @default(0)
  report              Int?      @default(0)

  this_ref_stats      users_product       @relation(fields: [ref_id_product], references: [id_product], onDelete: Cascade)

  @@index([ref_id_product])
  @@index([views])
  @@index([like, dislike])
  @@index([share])
  @@index([bookmark])
  @@index([report])
}

model users_video_stats {
  ref_id_product      Int       @unique
  views               Int?      @default(0)
  like                Int?      @default(0)
  dislike             Int?      @default(0)
  share               Int?      @default(0)
  bookmark            Int?      @default(0)
  report              Int?      @default(0)

  this_ref_stats      users_product       @relation(fields: [ref_id_product], references: [id_product], onDelete: Cascade)

  @@index([ref_id_product])
  @@index([views])
  @@index([like, dislike])
  @@index([share])
  @@index([bookmark])
  @@index([report])
}


model users_interactions_vote {
  ref_id_product      Int
  ref_id_sender       String                    @db.Uuid
  action_vote         status_action_vote?       @default(null)
  created_at          DateTime?                 @default(now()) @db.Timestamp(6)

  this_ref_vote_product       users_product       @relation(fields: [ref_id_product], references: [id_product], onDelete: Cascade)
  this_ref_vote_sender        users       @relation("video_vote_sender", fields: [ref_id_sender], references: [id], onDelete: Cascade)
 
  @@index([ref_id_product])
  @@unique([ref_id_product, ref_id_sender])
}

model users_interactions_comment {
  parent_id_comment   Int           @id
  type_comment        type_product
  ref_id_product      Int
  ref_id_sender       String        @db.Uuid
  text                String
  created_at          DateTime?     @default(now()) @db.Timestamp(6)

  @@index([parent_id_comment])
  @@index([ref_id_sender])

  this_ref_comment               users_product       @relation(fields: [ref_id_product], references: [id_product], onDelete: Cascade)          
  this_ref_comment_sender        users               @relation(fields: [ref_id_sender], references: [id], onDelete: Cascade)          
}

model users_interactions_bookmark {
  ref_id_product      Int
  ref_id_sender       String        @db.Uuid
  status              Boolean
  type_bookmark       type_product
  created_at          DateTime?     @default(now()) @db.Timestamp(6)

  @@unique([ref_id_product, ref_id_sender])
  @@index([status])

  this_ref_bookmark   users     @relation(fields: [ref_id_sender], references: [id], onDelete: Cascade)
  this_ref_bookmark_product   users_product     @relation(fields: [ref_id_product], references: [id_product], onDelete: Cascade)
}

model users_interactions_followers {
  ref_id_receiver   String        @db.Uuid
  ref_id_sender     String        @db.Uuid
  status            Boolean?      @default(false)
  created_at        DateTime?     @default(now()) @db.Timestamp(6)
  
  this_ref          users         @relation("users_target", fields: [ref_id_receiver], references: [id], onDelete: Cascade)
  this_ref_sender   users         @relation("users_sender", fields: [ref_id_sender], references: [id], onDelete: Cascade)

  @@unique([ref_id_receiver, ref_id_sender])
  @@index([status])
  @@index([ref_id_sender])
}

model users_interactions_report {
  ref_id_sender       String         @db.Uuid 
  ref_id_receiver     String         @db.Uuid
  ref_id_product      Int?
  type                type_report   
  text                Json?          @default("[]")
  created_at          DateTime?      @default(now()) @db.Timestamp(6)

  @@unique([ref_id_sender, ref_id_receiver])
  @@index([ref_id_sender])
  @@index([type])

  this_ref_sender     users      @relation("report_sender", fields: [ref_id_sender], references: [id], onDelete: Cascade)    
  this_ref_receiver   users      @relation("report_receiver", fields: [ref_id_receiver], references: [id], onDelete: Cascade)    
  this_ref_product    users_product?   @relation(fields: [ref_id_product], references: [id_product], onDelete: Cascade)

}



enum type_product {
  photo
  video
}

enum type_status_vote {
  like
  dislike
}

enum status_action_vote {
  like
  dislike
  null
}

enum user_gender {
  male
  female
  anonymous
}

enum user_role {
  admin
  creator
}

enum type_report {
  users
  image
  video
  music
}