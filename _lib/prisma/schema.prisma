generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model users {
  id                                                                                     String?                           @unique @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  public_id                                                                               String                            @unique
  first_name                                                                             String                            @db.VarChar(50)
  last_name                                                                              String                            @db.VarChar(50)
  email                                                                                  String                            @unique @db.VarChar(255)
  password                                                                               String?                           @db.VarChar(255)
  role                                                                                   user_role?                        @default(creator)
  created_at                                                                             DateTime?                         @default(now()) @db.Timestamp(6)
  users_description                                                                      users_description?
  users_product                                                                          users_product[]
  users_product_image_bookmark                                                           users_product_image_bookmark[]
  users_product_image_comment_users_product_image_comment_tar_iu_receiverTousers         users_product_image_comment[]     @relation("users_product_image_comment_tar_iu_receiverTousers")
  users_product_image_comment_users_product_image_comment_tar_iu_senderTousers           users_product_image_comment[]     @relation("users_product_image_comment_tar_iu_senderTousers")
  users_product_image_sub_comment_users_product_image_sub_comment_tar_iu_receiverTousers users_product_image_sub_comment[] @relation("users_product_image_sub_comment_tar_iu_receiverTousers")
  users_product_image_sub_comment_users_product_image_sub_comment_tar_iu_senderTousers   users_product_image_sub_comment[] @relation("users_product_image_sub_comment_tar_iu_senderTousers")
  users_product_image_vote_users_product_image_vote_tar_iu_receiverTousers               users_product_image_vote[]        @relation("users_product_image_vote_tar_iu_receiverTousers")
  users_product_image_vote_users_product_image_vote_tar_iu_senderTousers                 users_product_image_vote[]        @relation("users_product_image_vote_tar_iu_senderTousers")
  users_product_image_followers_sender                                                   users_followers[]                 @relation("users_sender")
  users_product_image_followers_receiver                                                 users_followers[]                 @relation("users_receiver")

   @@index([role])
   @@index([created_at])
}

model users_description {
  ref_id         String       @unique @db.Uuid
  username       String       @db.VarChar(50)
  biodata        String?      
  gender         user_gender? @default(anonymous)
  phone_number   String?         
  location       String?      
  picture        String?      
  social_link    Json?        @default("[]")
  updated_at     DateTime?    
  users          users        @relation(fields: [ref_id], references: [id], onDelete: Cascade)
}

model users_followers {
  ref_id_sender     String        @db.Uuid   
  ref_id_receiver   String        @db.Uuid
  id_follower       Int           @id
  created_at        DateTime?     @default(now()) @db.Timestamp(6)
  users_sender      users         @relation("users_sender", fields: [ref_id_sender], references: [id], onDelete: Cascade)
  users_receiver    users         @relation("users_receiver", fields: [ref_id_receiver], references: [id], onDelete: Cascade)

  @@unique([ref_id_sender, ref_id_receiver])
}

model users_product {
  ref_id                       String                         @db.Uuid
  id_product                   Int                            @unique
  type                         type_product?
  folder_name                  String                         @db.VarChar(255)
  status                       Boolean?                       @default(true)
  created_at                   DateTime?                      @default(now()) @db.Timestamp(6)
  users                        users                          @relation(fields: [ref_id], references: [id], onDelete: Cascade)
  users_product_image          users_product_image?
  users_product_video          users_product_video?
  users_product_image_bookmark users_product_image_bookmark[]
  users_product_image_vote     users_product_image_vote[]

  @@index([ref_id], name: "idx_ref_id")
  @@index([created_at], name: "idx_created_at")
  @@index([type], name: "idx_type")
  @@index([folder_name], name: "idx_folder_name")
  @@index([ref_id, created_at], name: "idx_ref_id_created_at")
}

model users_product_image {
  ref_id_product Int           @unique
  description    String        @db.VarChar(255)
  image_name     String        @db.VarChar(255)
  url            String        @db.VarChar(255)
  hashtag        String[]      @default([])
  category       String[]      @default([])
  users_product  users_product @relation(fields: [ref_id_product], references: [id_product], onDelete: Cascade)
}

model users_product_image_bookmark {
  ref_id_user    String        @db.Uuid
  ref_id_product Int          
  id_bookmark    Int           @unique
  status         Boolean?      @default(false)
  users          users         @relation(fields: [ref_id_user], references: [id], onDelete: Cascade)
  users_product  users_product @relation(fields: [ref_id_product], references: [id_product], onDelete: Cascade)
}

model users_product_image_comment {
  ref_id_sender                                            String                             @db.Uuid
  ref_id_receiver                                          String                              @db.Uuid
  id_image_comment                                         Int                               @id
  text                                                     String
  created_at                                               DateTime?                         @default(now()) @db.Timestamp(6)
  users_users_product_image_comment_tar_iu_receiverTousers users                             @relation("users_product_image_comment_tar_iu_receiverTousers", fields: [ref_id_receiver], references: [id], onDelete: Cascade)
  users_users_product_image_comment_tar_iu_senderTousers   users                             @relation("users_product_image_comment_tar_iu_senderTousers", fields: [ref_id_sender], references: [id], onDelete: Cascade)
  users_product_image_sub_comment                          users_product_image_sub_comment[]
}

model users_product_image_sub_comment {
  ref_id_comment                                               Int
  ref_id_sender                                                String     @db.Uuid
  ref_id_receiver                                              String     @db.Uuid
  id_sub_image_comment                                         Int                         @id
  text                                                         String
  created_at                                                   DateTime?                   @default(now()) @db.Timestamp(6)
  users_product_image_comment                                  users_product_image_comment @relation(fields: [ref_id_comment], references: [id_image_comment], onDelete: Cascade)
  users_users_product_image_sub_comment_tar_iu_receiverTousers users                       @relation("users_product_image_sub_comment_tar_iu_receiverTousers", fields: [ref_id_receiver], references: [id], onDelete: Cascade)
  users_users_product_image_sub_comment_tar_iu_senderTousers   users                       @relation("users_product_image_sub_comment_tar_iu_senderTousers", fields: [ref_id_sender], references: [id], onDelete: Cascade)
}

model users_product_image_vote {
  ref_id_sender                                         String      @db.Uuid
  ref_id_receiver                                       String      @db.Uuid
  ref_id_product                                        Int
  id_vote                                               Int           @id
  like                                                  Int           @default(0)
  dislike                                               Int           @default(0)
  status                                                Boolean?      @default(false)
  created_at                                            DateTime?     @default(now()) @db.Timestamp(6)
  users_product                                         users_product @relation(fields: [ref_id_product], references: [id_product], onDelete: Cascade)
  users_users_product_image_vote_tar_iu_receiverTousers users         @relation("users_product_image_vote_tar_iu_receiverTousers", fields: [ref_id_receiver], references: [id], onDelete: Cascade)
  users_users_product_image_vote_tar_iu_senderTousers   users         @relation("users_product_image_vote_tar_iu_senderTousers", fields: [ref_id_sender], references: [id], onDelete: Cascade)
}


model users_product_video {
  ref_id_product  Int             @unique
  description     String          @db.VarChar(255)
  duration        Float?
  width           Int?
  height          Int?
  format          String?
  cloud_public_id      String          @db.VarChar(255)
  url             String          @db.VarChar(255)
  thumbnail_url   String          @db.VarChar(255)           
  hashtag         String[]        @default([])
  category        String[]        @default([])

  users_product   users_product   @relation(fields: [ref_id_product], references: [id_product], onDelete: Cascade)

  @@unique([ref_id_product, cloud_public_id])
}

enum type_product {
  photo
  video
}

enum user_gender {
  male
  female
  anonymous
}

enum user_role {
  admin
  creator
}
